<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Note App</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Material Symbols -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- Markdown Library -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        /* Stili aggiuntivi per nascondere il contorno di textarea/preview e per la transizione */
        textarea:focus, textarea.focus-visible {
            outline: none;
        }
        .markdown-preview {
            transition: opacity 0.3s ease-in-out;
        }
        .hidden {
            display: none;
        }

        /* Stili personalizzati per l'output di Markdown */
        .markdown-content h1 {
            font-size: 1.875rem; /* 3xl */
            font-weight: 700;    /* bold */
            margin-top: 1.5rem;  /* mt-6 */
            margin-bottom: 1rem; /* mb-4 */
            color: #e5e7eb;      /* text-gray-200 */
        }
        .markdown-content h2 {
            font-size: 1.5rem;   /* 2xl */
            font-weight: 700;    /* bold */
            margin-top: 1.25rem; /* mt-5 */
            margin-bottom: 0.75rem; /* mb-3 */
            color: #d1d5db;      /* text-gray-300 */
        }
        .markdown-content h3 {
            font-size: 1.25rem;  /* xl */
            font-weight: 700;    /* bold */
            margin-top: 1rem;    /* mt-4 */
            margin-bottom: 0.5rem; /* mb-2 */
            color: #d1d5db;      /* text-gray-300 */
        }
        .markdown-content p {
            margin-bottom: 1rem; /* mb-4 */
            line-height: 1.625;  /* leading-relaxed */
        }
        .markdown-content a {
            color: #60a5fa;      /* text-blue-400 */
            text-decoration: underline;
        }
        .markdown-content ul {
            list-style-type: disc;
            list-style-position: inside;
            margin-bottom: 1rem; /* mb-4 */
            padding-left: 1rem;  /* pl-4 */
        }
        .markdown-content ol {
            list-style-type: decimal;
            list-style-position: inside;
            margin-bottom: 1rem; /* mb-4 */
            padding-left: 1rem;  /* pl-4 */
        }
        .markdown-content blockquote {
            border-left: 4px solid #4b5563; /* border-l-4 border-gray-600 */
            padding-left: 1rem;             /* pl-4 */
            font-style: italic;             /* italic */
            color: #9ca3af;                 /* text-gray-400 */
            margin-top: 1rem;               /* my-4 */
            margin-bottom: 1rem;            /* my-4 */
        }
        .markdown-content pre {
            background-color: #1f2937;      /* bg-gray-800 */
            padding: 0.75rem;               /* p-3 */
            border-radius: 0.5rem;          /* rounded-lg */
            overflow-x: auto;
            margin-top: 1rem;               /* my-4 */
            margin-bottom: 1rem;            /* my-4 */
        }
        .markdown-content code {
            background-color: #1f2937;      /* bg-gray-800 */
            border-radius: 0.25rem;         /* rounded */
            padding-left: 0.25rem;          /* px-1 */
            padding-right: 0.25rem;         /* px-1 */
            padding-top: 0.125rem;          /* py-0.5 */
            padding-bottom: 0.125rem;       /* py-0.5 */
            font-family: 'ui-monospace', 'SFMono-Regular', 'Menlo', 'Monaco', 'Consolas', 'Liberation Mono', 'Courier New', monospace; /* font-mono */
            font-size: 0.875rem;            /* text-sm */
        }
        .markdown-content pre code {
            background-color: transparent;
            padding: 0;
        }
    </style>
</head>
<body class="bg-gray-900 text-gray-100 font-sans p-4 flex flex-col h-screen overflow-hidden">
    <div class="container mx-auto flex flex-col h-full rounded-lg shadow-lg overflow-hidden">
        
        <!-- Header con titolo, contatore e controlli -->
        <header class="flex-shrink-0 flex justify-between items-center p-4 bg-gray-800 text-gray-400 border-b border-gray-700">
            <h1 class="text-xl font-bold text-gray-400">Note App</h1>
            <div class="flex items-center">
                <span id="char-counter" class="text-sm font-mono mr-4">0 caratteri</span>
                <button id="markdown-toggle" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-200" title="Anteprima Markdown">
                    <span class="material-symbols-outlined text-gray-400 text-2xl">
                        visibility
                    </span>
                </button>
                <button id="save-button" class="p-2 rounded-full hover:bg-gray-700 transition-colors duration-200 ml-2" title="Salva in file .md">
                    <span class="material-symbols-outlined text-gray-400 text-2xl">
                        save
                    </span>
                </button>
            </div>
        </header>

        <!-- Area di editing e anteprima -->
        <div class="flex-grow relative">
            <!-- Area di testo per l'editing -->
            <textarea id="note-editor" class="absolute inset-0 w-full h-full bg-gray-900 text-white p-4 resize-none leading-relaxed text-base placeholder-gray-600 focus:placeholder-gray-500 rounded-b-lg" placeholder="Inizia a digitare qui...">
            </textarea>
            
            <!-- Anteprima Markdown. Ora ha un container per lo stile -->
            <div id="markdown-preview" class="markdown-preview absolute inset-0 w-full h-full p-4 bg-gray-900 text-white overflow-y-auto leading-relaxed hidden">
                <div class="markdown-content">
                    <!-- Il contenuto Markdown convertito verrà inserito qui -->
                </div>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Riferimenti agli elementi del DOM
            const noteEditor = document.getElementById('note-editor');
            const markdownPreview = document.getElementById('markdown-preview');
            const markdownContent = document.querySelector('#markdown-preview .markdown-content');
            const markdownToggleBtn = document.getElementById('markdown-toggle');
            const saveButton = document.getElementById('save-button');
            const charCounter = document.getElementById('char-counter');

            // Nome della chiave per il localStorage
            const localStorageKey = 'simple-note-app-content';
            const defaultText = 'Scrivi qui le tue note. Supporto Markdown e salvataggio automatico. Clicca sull\'icona "salva" per esportare in .md!';

            // Carica il contenuto dal localStorage all'avvio
            const savedContent = localStorage.getItem(localStorageKey);
            if (savedContent && savedContent.trim() !== '') {
                noteEditor.value = savedContent;
            } else {
                noteEditor.value = defaultText;
            }

            // Funzione per aggiornare il contatore dei caratteri
            const updateCharCounter = () => {
            const textContent = noteEditor.value.trim() === defaultText.trim() ? '' : noteEditor.value;
                charCounter.textContent = `${textContent.length} caratteri`;
            };

            // Aggiorna il contatore all'avvio
            updateCharCounter();

            // Ascolta gli eventi di input per salvare automaticamente e aggiornare il contatore
            noteEditor.addEventListener('input', () => {
                localStorage.setItem(localStorageKey, noteEditor.value);
                updateCharCounter();
            });

            // Gestisce la rimozione del testo di default al primo focus
            let isFirstFocus = true;
            noteEditor.addEventListener('focus', () => {
                if (isFirstFocus && noteEditor.value === defaultText) {
                    noteEditor.value = '';
                    updateCharCounter();
                    isFirstFocus = false;
                }
            });

            // Gestisce il toggle tra l'editor e l'anteprima
            let isPreviewMode = false;
            markdownToggleBtn.addEventListener('click', () => {
                isPreviewMode = !isPreviewMode;
                
                if (isPreviewMode) {
                    // Passa alla modalità anteprima
                    noteEditor.classList.add('hidden');
                    markdownPreview.classList.remove('hidden');
                    // Esegui il parsing e inserisci nel contenitore con gli stili
                    markdownContent.innerHTML = marked.parse(noteEditor.value);
                    markdownToggleBtn.innerHTML = '<span class="material-symbols-outlined text-green-400 text-2xl">edit_note</span>';
                    markdownToggleBtn.title = 'Modifica';
                } else {
                    // Torna alla modalità di editing
                    noteEditor.classList.remove('hidden');
                    markdownPreview.classList.add('hidden');
                    markdownToggleBtn.innerHTML = '<span class="material-symbols-outlined text-gray-400 text-2xl">visibility</span>';
                    markdownToggleBtn.title = 'Anteprima Markdown';
                    noteEditor.focus();
                }
            });

            // Gestisce il salvataggio del file .md
            saveButton.addEventListener('click', () => {
                const textToSave = noteEditor.value === defaultText ? '' : noteEditor.value;
                const blob = new Blob([textToSave], { type: 'text/markdown' });
                const a = document.createElement('a');
                a.href = URL.createObjectURL(blob);
                a.download = 'note.md';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(a.href);
            });
        });
    </script>
</body>
</html>
